(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[284],{90643:function(e,t,r){"use strict";var n=r(59499),a=r(35944);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var l=function(e){var t=e.label,r=e.inputAttrs,n=e.placeholder;return(0,a.BX)("label",{className:"flex w-full justify-between",children:[(0,a.tZ)("span",{className:"text-gray-700",children:t}),(0,a.tZ)("input",o(o({type:"checkbox",className:" mt-1 block rounded-md border-main/50 shadow-sm focus:border-main focus:ring focus:ring-main/50 "},r),{},{placeholder:void 0===n?"":n}))]})};t.Z=l},62252:function(e,t,r){"use strict";var n=r(59499),a=r(4730),i=r(39299),o=r(87536),l=r(35944),u=["control","name","label","onChange"];function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var f=function(e){var t=e.control,r=e.name,n=e.label,c=e.onChange,f=(0,a.Z)(e,u),d=(0,o.bc)({control:t,name:r}).field,p=f.isMulti?f.options.filter(function(e){var t;return null===(t=d.value)||void 0===t?void 0:t.includes(e.value)}):f.options.find(function(e){return e.value===d.value}),m=s(s({},f),{},{value:p,onChange:function(e){c?c(e):d.onChange(Array.isArray(e)?e.map(function(e){return e.value}):e.value)},className:"".concat(null==f?void 0:f.className," w-full"),isSearchable:!1});return(0,l.tZ)(l.HY,{children:n?(0,l.BX)("label",{children:[n,(0,l.tZ)(i.ZP,s({},m))]}):(0,l.tZ)(i.ZP,s({},m))})};t.Z=f},84805:function(e,t,r){"use strict";r.d(t,{Z:function(){return v}});var n=r(59499),a=r(78773),i=r(97088),o=r(87536),l=r(90643),u=r(90116),c=r(67294),s=r(73759),f=r(62252),d=r(35944),p=function(e){var t=e.control,r=e.roleType,n=(0,s.Z)(),a=n.roles;n.loading,n.error;var i=(0,o.bc)({control:t,name:"role_ids"}).field,l=a&&a.filter(function(e){return e.roleType===r}).filter(function(e){return"User"!==e.name}).map(function(e){return{value:e.id,label:e.name}});return(0,c.useEffect)(function(){if(l&&!i.value){var e=[l.find(function(e){return"Learner"===e.label})];i.onChange(e.map(function(e){return e.value}))}},[a]),(0,d.tZ)(d.HY,{children:a&&(0,d.tZ)(f.Z,{onChange:function(e){var t=[].concat((0,u.Z)(e),(0,u.Z)(e.length?[]:[l.find(function(e){return"Learner"===e.label})]));i.onChange(t.map(function(e){return e.value}))},label:"Roles",control:t,name:"role_ids",isMulti:!0,options:l})})},m=r(77961);function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var v=function(e){var t=e.user,r=void 0===t?null:t,n=e.onSubmit;console.log("user?.roles.map(role => role.id)"),console.log(null==r?void 0:r.roles.map(function(e){return e.id}));var u=g(g({},r),{},{firstName:null==r?void 0:r.firstName,lastName:null==r?void 0:r.lastName,role_ids:null==r?void 0:r.roles.map(function(e){return e.id})}),c=(0,o.cI)({defaultValues:u}),s=c.register,f=c.handleSubmit,b=c.control,v=c.formState.errors;c.watch;var y=function(e){n(e)};return(0,d.BX)("form",{className:"h-full w-full max-w-sm flex flex-col space-y-4",onSubmit:f(y),children:[(0,d.tZ)(i.Z,{label:"First name",placeholder:"First name",inputAttrs:s("firstName",{required:"First name is required",maxLength:{value:20,message:"Max length of the name is 20"}})}),v.firstName&&(0,d.tZ)("small",{className:"text-danger text-red-500",children:v.firstName.message}),(0,d.tZ)(i.Z,{label:"Last name",placeholder:"Last name",inputAttrs:s("lastName",{required:"Last is required",maxLength:{value:20,message:"Max length of the name is 20"}})}),v.lastName&&(0,d.tZ)("small",{className:"text-danger text-red-500",children:v.lastName.message}),(0,d.tZ)(i.Z,{label:"Email",placeholder:"email",inputAttrs:s("email",{required:"Email is required",maxLength:{value:40,message:"Max length of the name is 40"},pattern:{value:/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,24}$/i,message:"Please give valid email"}})}),v.email&&(0,d.tZ)("small",{className:"text-danger text-red-500",children:v.email.message}),(0,d.tZ)(m.Z,{buttonText:"Choose profile image",label:"Profile image",control:b,name:"profile_image",initialValue:null==r?void 0:r.profileImageUrl}),(0,d.tZ)(p,{control:b,roleType:"tenant_role"}),r?(0,d.tZ)(l.Z,{label:"Send the user an invitation email",inputAttrs:s("invite")}):(0,d.tZ)(l.Z,{label:"Send user an invitation upon creation",inputAttrs:s("invite")}),(0,d.tZ)(a.Z,{type:"submit",children:"Submit"})]})}},39106:function(e,t,r){"use strict";r.d(t,{EM:function(){return c},xt:function(){return u}});var n,a,i,o=r(71383),l=r(17283),u=(0,l.Ps)(n||(n=(0,o.Z)(["\n  fragment CapabilityFragment on Capability {\n    id\n    name\n    capabilityType\n    details\n    # _deleted @client\n  }\n"])));(0,l.Ps)(a||(a=(0,o.Z)(["\n  query GetCapability($id: ID!) {\n    capability(id: $id) {\n      ...CapabilityFragment\n    }\n  }\n  ","\n"])),u);var c=(0,l.Ps)(i||(i=(0,o.Z)(["\n  query GetCapabilities {\n    capabilities {\n      ...CapabilityFragment\n    }\n  }\n  ","\n"])),u)},26815:function(e,t,r){"use strict";r.d(t,{$r:function(){return s},Qi:function(){return f},o3:function(){return c}});var n,a,i,o=r(71383),l=r(17283),u=r(39106),c=(0,l.Ps)(n||(n=(0,o.Z)(["\n  fragment RoleFragment on Role {\n    id\n    name\n    roleType\n    _deleted @client\n  }\n"]))),s=(0,l.Ps)(a||(a=(0,o.Z)(["\n  query GetRole($id: ID!) {\n    role(id: $id) {\n      ...RoleFragment\n      capabilities {\n        ...CapabilityFragment\n      }\n    }\n  }\n  ","\n  ","\n"])),c,u.xt),f=(0,l.Ps)(i||(i=(0,o.Z)(["\n  query GetRoles {\n    roles {\n      ...RoleFragment\n      \n    }\n  }\n  ","\n"])),c)},73759:function(e,t,r){"use strict";var n=r(71641),a=r(26815);t.Z=function(){var e=(0,n.a)(a.Qi),t=e.loading,r=e.error,i=e.data;return{roles:(i=void 0===i?{}:i).roles,loading:t,error:r}}},3130:function(e,t,r){"use strict";var n=r(50051),a=r(71641);t.Z=function(){var e=(0,a.a)(n.fo),t=e.loading,r=e.error,i=e.data;return{users:(i=void 0===i?{}:i).users,loading:t,error:r,refetchUsers:e.refetch}}},64467:function(e,t,r){"use strict";r.r(t);var n=r(59499),a=r(4730),i=r(40350),o=r(84805),l=r(24545),u=r(11163),c=r(3130),s=r(50196),f=r(39316),d=r(69291),p=r(50051),m=r(94225),b=r(35944),g=["profile_image","firstName","lastName"];function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var h=function(){return(0,b.BX)(b.HY,{children:[(0,b.tZ)("span",{className:"hidden lg:block",children:"Back to user list"}),(0,b.tZ)("span",{className:"block lg:hidden",children:(0,b.tZ)(f.x,{width:"20"})})]})},O=function(){(0,i.Z)({title:"Add new user"}),(0,l.Z)([[(0,b.tZ)(h,{}),"/admin/users"]]);var e=(0,u.useRouter)(),t=(0,c.Z)().refetchUsers,r=(0,d.Z)({method:"PUT",refetchQuery:p.fo,onComplete:function(e){m.ZP.modify({id:m.ZP.identify(e.data.user),fields:{profileImageUrl:function(t){return e.data.user.profile_image_url}}})}}).uploadFileAndNotify,n=function(n){var i=n.profile_image,o=n.firstName,l=n.lastName,u=(0,a.Z)(n,g);console.log(u);var c=localStorage.getItem("token"),f={user:y(y({},u),{},{first_name:o,last_name:l})};s.ZP.request({method:"post",url:"/api/v1/users/",headers:{Authorization:"Bearer ".concat(c)},data:f}).then(function(n){var a;if(t(),null!==(a=n.data.user)&&void 0!==a&&a.id&&i){var o,l="/api/v1/users/".concat(null===(o=n.data.user)||void 0===o?void 0:o.id,"/update_profile_image");i instanceof File&&r(i,"profile_image",l)}e.push("/admin/users")})};return(0,b.tZ)(b.HY,{children:(0,b.tZ)(o.Z,{onSubmit:n})})};O.navState={topLevel:"users",secondary:"overview"},t.default=O},32967:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/users/create",function(){return r(64467)}])},4730:function(e,t,r){"use strict";function n(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}r.d(t,{Z:function(){return n}})}},function(e){e.O(0,[9299,6107,7216,9774,2888,179],function(){return e(e.s=32967)}),_N_E=e.O()}]);