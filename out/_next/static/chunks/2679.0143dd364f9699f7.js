"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2679],{82679:function(e,t,n){n.r(t),n.d(t,{IFrameWithRef:function(){return j},PackageIFrame:function(){return Z},default:function(){return $}});var r,o,c,a=n(17674),d=n(59499),i=n(4730),u=n(71383),l=n(67294),s=n(67342),m=n.n(s),f=n(17283),p=n(50319),v=n(71641),I=(0,f.Ps)(r||(r=(0,u.Z)(["\n  mutation UpsertScoAttempt(\n    $data: JSON!,\n    $attempt: Int!,\n    $contentItemId: ID!,\n    $scormModuleId: ID!\n  ) {\n    upsertScoAttempt(input: {\n      data: $data,\n      attempt: $attempt,\n      contentItemId: $contentItemId,\n      scormModuleId: $scormModuleId\n    }) {\n      id\n      data\n    }\n  }\n"]))),w=(0,f.Ps)(o||(o=(0,u.Z)(["\n  query GetLatestScoAttempt(\n    $courseId: ID!,\n    $scormModuleId: ID!,\n  ) {\n    latestScoAttempt(\n      courseId: $courseId,\n      scormModuleId: $scormModuleId\n    ) {\n      data\n      attempt\n    }\n  }\n"]))),b=n(24249),O=n(64202),S=n(94225),y=n(35944),P=["iframeRef"];function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){(0,d.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}(0,f.Ps)(c||(c=(0,u.Z)(["\nquery GetUserDataForScorm {\n  user {\n    fullName\n    id\n  }\n}\n"])));var j=function(e){var t=e.iframeRef,n=(0,i.Z)(e,P);return(0,y.tZ)(Z,A(A({},n),{},{ref:t}))},Z=l.forwardRef(function(e,t){var n,r=e.block,o=e.isEditing,c=void 0!==o&&o,d=e.setAttempt,i=void 0===d?function(){return null}:d,u=e.attempt,s=(0,l.useState)(!1),f=s[0],P=s[1],g=(0,b.t)().query.id,A=(0,p.D)(I),j=(0,a.Z)(A,2),Z=j[0];j[1];var $=(0,v.a)(w,{variables:{scormModuleId:r.properties.moduleId,courseId:g}}),h=($.loading,$.data);$.error;var D=(0,l.useRef)(null),E=(0,l.useCallback)(function(e){console.log("data"),console.log(e),["completed","passed"].includes(null==e?void 0:e.cmi.core.lesson_status)&&(0,S.AP)(!1),Z({variables:{attempt:u,contentItemId:g,scormModuleId:r.properties.moduleId,data:e}}).then(function(e){})},[u]),M=function(){},k=(0,l.useCallback)(function(){if(m(),!window.API&&h){var e,t=D.current=window.API=new window.Scorm12API({});t.on("LMSSetValue.cmi.*",function(e,n){t.storeData(!0);var r=t.renderCommitCMI(!0);"cmi.core.exit"===e&&"suspend"===n||(document.querySelector("#debug_panel").innerHTML="<pre>"+JSON.stringify(r,null,2)+"</pre>"),c||E(r)}),t.loadFromJSON(null==h?void 0:null===(e=h.latestScoAttempt)||void 0===e?void 0:e.data,""),window.addEventListener("beforeunload",M),window.addEventListener("unload",M),P(!0)}},[u,E,h]);return(0,l.useEffect)(function(){return k(),function(){window.API=D.current=null,M(),window.removeEventListener("beforeunload",M),window.removeEventListener("unload",M)}},[k]),(0,l.useEffect)(function(){if(h){var e,t,n,r,o;i(null!==(e=null==h?void 0:null===(t=h.latestScoAttempt)||void 0===t?void 0:t.attempt)&&void 0!==e?e:1),(null===(n=h.latestScoAttempt)||void 0===n?void 0:n.data)&&D.current.loadFromJSON(null===(r=h.latestScoAttempt)||void 0===r?void 0:null===(o=r.data)||void 0===o?void 0:o.cmi)}},[h]),(0,y.tZ)(y.HY,{children:f?(0,y.tZ)("iframe",{ref:t,src:null===(n=r.properties)||void 0===n?void 0:n.url},"".concat(r.id,"--").concat(u)):(0,y.tZ)("div",{className:"flex items-center justify-center",children:(0,y.tZ)(O.Z,{})})})}),$=l.memo(j)}}]);